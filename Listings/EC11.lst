C51 COMPILER V9.60.7.0   EC11                                                              01/05/2026 22:26:27 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE EC11
OBJECT MODULE PLACED IN .\Objects\EC11.obj
COMPILER INVOKED BY: E:\AAAAAA\Keil_v5\C51\BIN\C51.EXE Hardware\EC11.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\User;.\Li
                    -b;.\Hardware;.\App;.\Bare-MetalMultitasking;.\Hardware\I2Csoft_oled) DEBUG OBJECTEXTEND PRINT(.\Listings\EC11.lst) OBJEC
                    -T(.\Objects\EC11.obj)

line level    source

   1          #include "EC11.h"
   2          extern u32 sys_ms;
   3          
   4          static void GPIO_config(void) {
   5   1          //准双向口
   6   1              P3_MODE_IO_PU(GPIO_Pin_6);
   7   1                      P3_MODE_IO_PU(GPIO_Pin_7);
   8   1                      P4_MODE_IO_PU(GPIO_Pin_7);      
   9   1      }
  10          
  11          void EC11_init(){
  12   1                      GPIO_config();
  13   1      }
  14          
  15          // 编码器状态变化表
  16          const char encoder_table[16] = {
  17              0, -1, 1, 0,
  18              1, 0, 0, -1,
  19              -1, 0, 0, 1,
  20              0, 1, -1, 0
  21          };
  22          
  23          // 全局计数
  24          static int EC11_count = 0;
  25          static u8 last_state = 0;
  26          
  27          void EC11_Knob(){
  28   1          static u8 pin_a, pin_b;
  29   1          static u8 curr_state;
  30   1          static u8 idx; 
  31   1          char dir;
  32   1      
  33   1          pin_a = P37;
  34   1          pin_b = P36;
  35   1      
  36   1          if (pin_a == 0 && pin_b == 0) {
  37   2              curr_state = 0;
  38   2          } else if (pin_a == 0 && pin_b == 1) {
  39   2              curr_state = 1;
  40   2          } else if (pin_a == 1 && pin_b == 0) {
  41   2              curr_state = 2;
  42   2          } else if (pin_a == 1 && pin_b == 1) {
  43   2              curr_state = 3;
  44   2          }
  45   1      
  46   1          idx = (last_state * 4) + curr_state;  // 代替 last_state << 2
  47   1          dir = encoder_table[idx];
  48   1      
  49   1          if (dir != 0) {
  50   2              EC11_count += dir;
  51   2          }
  52   1      
  53   1          last_state = curr_state;
C51 COMPILER V9.60.7.0   EC11                                                              01/05/2026 22:26:27 PAGE 2   

  54   1                      //  red  orange  yellow  green  cyan  blue  purple
  55   1                      // 0    5      10                15     20    25    30      35
  56   1      }
  57          
  58          // 获取计数值
  59          int EC11_GetCount(void) {
  60   1          return EC11_count;
  61   1      }
  62          
  63          u8 pre_ec11key_state = 0;
  64          
  65          void EC11_Btn(){
  66   1                      if(pre_ec11key_state == 0 && EC11_KEY == 1) {
  67   2      
  68   2              // 记录最后一次(上一次)的状态为抬起
  69   2                                      Keys_on_keydown(5);                     
  70   2              pre_ec11key_state = 1;
  71   2      
  72   2              // P01 = 0;
  73   2          } else if(pre_ec11key_state == 1 && EC11_KEY == 0) {
  74   2      
  75   2              // 记录最后一次(上一次)的状态为按下
  76   2                                      //Keys_on_keyup(5);
  77   2              pre_ec11key_state = 0;
  78   2          }
  79   1      }
  80          
  81          void EC11_Btn_Scan()
  82          {
  83   1                      EC11_Btn();
  84   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    199    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     24    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
