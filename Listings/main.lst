C51 COMPILER V9.60.7.0   MAIN                                                              01/05/2026 22:26:25 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\AAAAAA\Keil_v5\C51\BIN\C51.EXE User\main.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\User;.\Lib;.\
                    -Hardware;.\App;.\Bare-MetalMultitasking;.\Hardware\I2Csoft_oled) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\
                    -Objects\main.obj)

line level    source

   1          #include "switch.h"
   2          #include "Exti.h"
   3          #include "GPIO.h"
   4          #include "UART.h"
   5          #include "NVIC.h"
   6          #include "Timer.h"
   7          #include "Soft_I2C.h"
   8          #include "App.h"
   9          #include "task.h"
  10          
  11          static void GPIO_config(void) {
  12   1                      //I2C P32 P33 OD
  13   1                      P3_MODE_OUT_OD(GPIO_Pin_2);
  14   1          P3_MODE_OUT_OD(GPIO_Pin_3);
  15   1                      // 板载LED
  16   1                      P5_MODE_OUT_PP(GPIO_Pin_3);
  17   1      }
  18          
  19          static void UART_config(void) {
  20   1              // >>> 记得添加 NVIC.c, UART.c, UART_Isr.c <<<
  21   1          COMx_InitDefine             COMx_InitStructure;                                     //结构定义
  22   1          COMx_InitStructure.UART_Mode      = UART_8bit_BRTx; //模式, UART_ShiftRight,UART_8bit_BRTx,UART_9bit,U
             -ART_9bit_BRTx
  23   1          COMx_InitStructure.UART_BRT_Use   = BRT_Timer1;                     //选择波特率发生器, BRT_Timer1, BRT_Timer2 (注意: 串
             -口2固定使用BRT_Timer2)
  24   1          COMx_InitStructure.UART_BaudRate  = 115200ul;                       //波特率, 一般 110 ~ 115200
  25   1          COMx_InitStructure.UART_RxEnable  = ENABLE;                         //接收允许,   ENABLE或DISABLE
  26   1          COMx_InitStructure.BaudRateDouble = DISABLE;                        //波特率加倍, ENABLE或DISABLE
  27   1          UART_Configuration(UART1, &COMx_InitStructure);             //初始化串口1 UART1,UART2,UART3,UART4
  28   1      
  29   1              NVIC_UART1_Init(ENABLE,Priority_3);             //中断使能, ENABLE/DISABLE; 优先级(低到高) Priority_0,Priority_1,P
             -riority_2,Priority_3
  30   1          UART1_SW(UART1_SW_P30_P31);         // 引脚选择, UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17,UART1_SW_
             -P43_P44
  31   1      }
  32          
  33          
  34          static void Timer_config(void){
  35   1                      TIM_InitTypeDef         TIM_InitStructure;                                              //结构定义
  36   1                      //定时器0做16位自动重装, 中断频率为1000HZ
  37   1                      TIM_InitStructure.TIM_Mode      = TIM_16BitAutoReload;  //指定工作模式,   TIM_16BitAutoReload,TIM_16Bit,T
             -IM_8BitAutoReload,TIM_16BitAutoReloadNoMask
  38   1                      TIM_InitStructure.TIM_ClkSource = TIM_CLOCK_1T;         //指定时钟源,     TIM_CLOCK_1T,TIM_CLOCK_12T,TIM_CLOCK_
             -Ext
  39   1                      TIM_InitStructure.TIM_ClkOut    = DISABLE;                              //是否输出高速脉冲, ENABLE或DISABLE
  40   1                      TIM_InitStructure.TIM_Value     = 65536UL - (MAIN_Fosc / 1000UL);               //初值,
  41   1                      TIM_InitStructure.TIM_Run       = ENABLE;                               //是否初始化后启动定时器, ENABLE或DISABLE
  42   1                      Timer_Inilize(Timer0,&TIM_InitStructure);                               //初始化Timer0    Timer0,Timer1,Timer2,Timer3,Timer4
  43   1                      NVIC_Timer0_Init(ENABLE,Priority_0);            //中断使能, ENABLE/DISABLE; 优先级(低到高) Priority_0,Priority_1,P
             -riority_2,Priority_3
  44   1      }
  45          
  46          
C51 COMPILER V9.60.7.0   MAIN                                                              01/05/2026 22:26:25 PAGE 2   

  47          u32 sys_ms = 0; // 全局 时间计数
  48          void Timer0_ISR_Handler (void) interrupt TMR0_VECTOR    //进中断时已经清除标志
  49          {               // 1ms
  50   1                      // 任务切换函数(中断里调用)
  51   1                      Task_switch_handler();
  52   1                      sys_ms++;
  53   1      }
  54          
  55          #if EC11    // 不用旋钮中断
              void INT2_ISR_Handler (void) interrupt INT2_VECTOR              //进中断时已经清除标志
              {
                              EC11_Knob();// INT2 中断服务函数（P3.6）                
              }
              
              void INT3_ISR_Handler (void) interrupt INT3_VECTOR              //进中断时已经清除标志
              {
                              EC11_Knob();// INT3 中断服务函数（P3.7）
              }
              #endif
  66          
  67          int main(){
  68   1              EAXSFR();               /* 扩展寄存器访问使能 */
  69   1                      GPIO_config();
  70   1                      UART_config();
  71   1                      Timer_config();
  72   1                      Task_init();     // 裸机多任务
  73   1          
  74   1      #if EC11        // 旋钮的外部中断
                  // 配置 INT2、INT3 中断
                  INT2_Interrupt(1);   // 使能 INT2
                  INT3_Interrupt(1);   // 使能 INT3
              #endif
  79   1                      EA = 1;
  80   1                      printf(" UART Init Success ! \n");
  81   1                      
  82   1                      //灯的初始化
  83   1                      WS2812_initLED();
  84   1                      printf(" WS2812 Init  ! \n");
  85   1      
  86   1                      App_OLED_refresh();
  87   1              printf(" I2C OLED Init  ! \n");
  88   1                      while(1){
  89   2                                      // 任务执行函数(main函数while里调用)
  90   2                                      Task_exec_handler();
  91   2                      }
  92   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    238    ----
   CONSTANT SIZE    =     61    ----
   XDATA SIZE       =      2      16
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
